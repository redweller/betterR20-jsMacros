if(d20plus.combat){const e=d20.engine.selected().map((e=>e.model)).filter((e=>!!e?.character));d20plus.combat.doLock(e)}else{const e="stopwatch";d20plus.combat={tokensLocked:!1,previous:"null",init:()=>{const e=d20.Campaign.initiativewindow;d20plus.ut.injectCode(e.model,"save",((t,o)=>{const s=t(...o),a=JSON.parse(e.model.attributes.turnorder);if(a.length){const e=d20plus.ut.getTokenById(a[0]?.id)?.character?.id,t=d20.Campaign.activePage().thegraphics.models.filter((t=>t.attributes.represents===e));d20plus.combat.previous!==t[0]?.id&&d20plus.combat.doLock(t,"-1"!==t[0]?.id),d20plus.combat.previous=t[0]?.id}else""!==d20plus.combat.previous&&d20plus.combat.doLock([],!1),d20plus.combat.previous="";return s}))},doLock:(t,o)=>{t=t||[],d20.engine.selected().length>1&&d20.engine.unselect();const s=void 0===o?!!t.length||!d20plus.combat.tokensLocked:o,a=({attributes:{statusmarkers:t}},o)=>o?t.split(",").filter((e=>!!e)).concat(t.includes(e)?[]:e).join(","):t.split(",").filter((t=>t!==e)).join(",");d20.Campaign.activePage().thegraphics.models.filter((e=>!!e.character)).filter((({attributes:e,character:{attributes:t}})=>!!t.controlledby&&"all"!==t.controlledby&&"objects"===e.layer)).forEach((e=>e.save({lockMovement:s,statusmarkers:a(e,s)}))),d20plus.combat.tokensLocked=s,t.length&&setTimeout((()=>{t.forEach((e=>e.save({lockMovement:!1,statusmarkers:a(e,!1)}))),d20plus.combat.tokensLocked=!1}),200)}},d20plus.combat.init()}