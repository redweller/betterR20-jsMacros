let t=20;const e=d20.engine.selected(),n=e[0]?.model;if(1!==e.length||"text"!==n?.attributes?.type)return d20plus.ut.sendHackerChat("Please select one text object",!0);const i=n.attributes.font_style,s=n.attributes.text.split("\n\n").map((e=>e.split("\n").map((e=>(e.length>t&&(t=e.length),e.trim()))).join(" "))).join("\n"),l=$(`\n\t<div style="width: 350px;">\n\t\t<textarea style="width:100%;height:150px;box-sizing:border-box;">${s}</textarea>\n\t\t<p>\n\t\t\tChange width in symbols: <input value="${t}" type="number" style="width:50px;float:right"><br>\n\t\t\t<span style="font-size:12px">Must be integer greater than 20</span>\n\t\t</p><p>\n\t\t\tChange font size: <input value="${n.attributes.font_size}" type="number" style="width:50px;float:right"><br>\n\t\t\t<span style="font-size:12px">Must be integer between 8 and 72</span><br>\n\t\t\t<span style="font-size:12px">Will be reset if you modify text in standard editor</span>\n\t\t</p><p>\n\t\t\tSelect text style:\n\t\t\t<select style="width:60px;float:right">${["","bold","italic","condensed","bold italic","bold condensed","italic condensed","italic condensed bold"].reduce(((t,e)=>`${t}<option${i===e?" selected":""} value="${e}">${e}</option>`),"")}\n\t\t\t</select><br>\n\t\t\t<span style="font-size:12px">Will be preserved even after edits</span>\n\t\t</p>\n\t</div>\n`).dialog({autoopen:!0,title:"Edit text",buttons:{Cancel:()=>{l.off(),l.dialog("destroy").remove()},Save:()=>{const t=l.find("input:first-child"),e=l.find("select").val(),i=Math.max(t.first().val(),20),s=Number(t.last().val()),a=new RegExp(`(.{1,${i}}(?:$| ))`,"gm"),o=l.find("textarea").val().split("\n").map((t=>t.trim().replace(a,"$1\n"))).join("\n");n.save({text:o,font_style:e,font_size:!isNaN(s)&&s>7&&s<73?s:n.attributes.font_size})}},close:()=>{l.off(),l.dialog("destroy").remove()}})